<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOUNDRY // OS - Enterprise Ontology</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.26.0/cytoscape.min.js"></script>
    <script src="https://unpkg.com/layout-base/layout-base.js"></script>
    <script src="https://unpkg.com/cose-base/cose-base.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape-context-menus/4.1.0/cytoscape-context-menus.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cytoscape-context-menus/4.1.0/cytoscape-context-menus.min.css">

    <style>
        /* --- CORE SYSTEM THEME --- */
        :root {
            --bg-deep: #050505;
            --bg-panel: rgba(20, 20, 23, 0.95);
            --border-dim: #333;
            --border-highlight: #555;
            
            --accent-primary: #3b82f6; /* Blue Core */
            --accent-secondary: #8b5cf6; /* Purple AI */
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;

            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            
            --glass: blur(12px);
        }

        * { box-sizing: border-box; outline: none; user-select: none; }
        
        body {
            background-color: var(--bg-deep);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            margin: 0; overflow: hidden; height: 100vh; width: 100vw;
            display: grid;
            grid-template-rows: 50px 1fr 30px; /* Top, Main, Status */
        }

        /* --- 1. TOP COMMAND BAR --- */
        .top-deck {
            background: var(--bg-panel); border-bottom: 1px solid var(--border-dim);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; z-index: 50;
        }
        .brand { 
            font-family: 'JetBrains Mono', monospace; font-weight: 700; letter-spacing: 2px; 
            color: #fff; display: flex; align-items: center; gap: 10px;
        }
        .brand span { color: var(--accent-primary); }
        
        .toolbar { display: flex; gap: 5px; }
        .tool-btn {
            background: transparent; border: 1px solid transparent; color: var(--text-secondary);
            padding: 6px 12px; border-radius: 4px; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; gap: 8px; font-size: 13px;
        }
        .tool-btn:hover { background: rgba(255,255,255,0.05); color: #fff; border-color: var(--border-dim); }
        .tool-btn.active { background: rgba(59, 130, 246, 0.2); color: var(--accent-primary); border-color: var(--accent-primary); }

        .search-box {
            background: #111; border: 1px solid var(--border-dim); color: #fff;
            padding: 6px 12px; border-radius: 4px; width: 250px; font-family: 'JetBrains Mono';
        }
        .search-box:focus { border-color: var(--accent-primary); }

        /* --- 2. WORKSPACE LAYOUT --- */
        .workspace { display: flex; position: relative; height: 100%; overflow: hidden; }

        /* Left Panel (AI & Filters) */
        .left-panel {
            width: 60px; /* Collapsed state */
            background: var(--bg-panel); border-right: 1px solid var(--border-dim);
            display: flex; flex-direction: column; align-items: center; padding-top: 10px;
            transition: width 0.3s ease; z-index: 40;
        }
        .left-panel.expanded { width: 280px; align-items: stretch; padding: 10px; }
        
        .icon-nav { display: flex; flex-direction: column; gap: 15px; align-items: center; width: 60px; }
        .nav-item { 
            font-size: 18px; color: var(--text-secondary); cursor: pointer; 
            width: 40px; height: 40px; display: flex; justify-content: center; align-items: center;
            border-radius: 8px; transition: 0.2s;
        }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.1); color: #fff; }

        .panel-content { display: none; padding-left: 10px; opacity: 0; animation: fadeIn 0.5s forwards;}
        .left-panel.expanded .panel-content { display: block; }

        /* Main Graph Area */
        #cy {
            flex: 1; background-image: 
                radial-gradient(rgba(50,50,50,0.3) 1px, transparent 1px);
            background-size: 20px 20px; position: relative;
        }
        
        /* Floating Overlay for Graph Stats */
        .graph-stats {
            position: absolute; top: 20px; left: 20px; pointer-events: none;
            font-family: 'JetBrains Mono'; font-size: 10px; color: rgba(255,255,255,0.3);
        }

        /* Right Panel (Object Details) */
        .right-panel {
            width: 0; background: var(--bg-panel); border-left: 1px solid var(--border-dim);
            transition: width 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            overflow-y: auto; z-index: 45; display: flex; flex-direction: column;
        }
        .right-panel.active { width: 400px; box-shadow: -10px 0 30px rgba(0,0,0,0.5); }

        .rp-header { padding: 20px; border-bottom: 1px solid var(--border-dim); background: rgba(255,255,255,0.02); }
        .rp-body { padding: 20px; flex: 1; }

        /* --- 3. COMPONENTS --- */
        .badge { 
            padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; 
            text-transform: uppercase; letter-spacing: 1px;
        }
        .bg-blue { background: rgba(59, 130, 246, 0.2); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.4); }
        .bg-red { background: rgba(239, 68, 68, 0.2); color: #fca5a5; border: 1px solid rgba(239, 68, 68, 0.4); }
        
        /* Metric Cards */
        .metric-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .metric-card { 
            background: rgba(255,255,255,0.03); border: 1px solid var(--border-dim); 
            padding: 10px; border-radius: 6px; 
        }
        .metric-val { font-size: 18px; font-weight: bold; color: #fff; font-family: 'JetBrains Mono'; }
        .metric-label { font-size: 10px; color: var(--text-secondary); text-transform: uppercase; }

        /* Buttons */
        .btn-action {
            width: 100%; background: var(--accent-primary); color: #fff; border: none;
            padding: 12px; font-weight: 600; cursor: pointer; border-radius: 4px; margin-top: 10px;
            display: flex; justify-content: center; align-items: center; gap: 8px;
            transition: 0.2s;
        }
        .btn-action:hover { filter: brightness(1.2); box-shadow: 0 0 15px var(--accent-primary); }

        /* --- 4. STATUS BAR --- */
        .status-bar {
            background: #000; border-top: 1px solid var(--border-dim);
            display: flex; align-items: center; justify-content: space-between; padding: 0 15px;
            font-size: 11px; color: #666; font-family: 'JetBrains Mono';
        }
        .status-light { width: 8px; height: 8px; border-radius: 50%; background: var(--accent-success); display: inline-block; margin-right: 5px; animation: pulse 2s infinite; }

        @keyframes pulse { 0% { opacity: 0.5; box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 70% { opacity: 1; box-shadow: 0 0 0 5px rgba(16, 185, 129, 0); } 100% { opacity: 0.5; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Context Menu Override */
        .cy-context-menus-cxt-menu { background-color: #222; border: 1px solid #444; color: #fff; padding: 5px; box-shadow: 0 5px 15px rgba(0,0,0,0.8); }
        .cy-context-menus-cxt-menuitem { padding: 8px 15px; cursor: pointer; font-size: 12px; transition: 0.2s; }
        .cy-context-menus-cxt-menuitem:hover { background-color: var(--accent-primary); color: #fff; }

        /* Upload Input Hidden */
        input[type="file"] { display: none; }

    </style>
</head>
<body>

    <div class="top-deck">
        <div class="brand">
            <i class="fas fa-cube"></i> FOUNDRY<span>//OS</span>
        </div>
        
        <div class="toolbar">
            <input type="text" id="global-search" class="search-box" placeholder="Search Ontology Object..." onkeyup="searchGraph()">
            <div style="width: 20px;"></div>
            <button class="tool-btn" onclick="layoutRun('grid')"><i class="fas fa-th"></i> Grid</button>
            <button class="tool-btn" onclick="layoutRun('circle')"><i class="fas fa-circle-notch"></i> Circle</button>
            <button class="tool-btn active" onclick="layoutRun('breadthfirst')"><i class="fas fa-sitemap"></i> Hierarchy</button>
            <div style="width: 20px;"></div>
            <label for="file-upload" class="tool-btn" style="border-color: #444;"><i class="fas fa-upload"></i> Import Data</label>
            <input type="file" id="file-upload" accept=".xlsx, .xls">
            <button class="tool-btn" style="color: var(--accent-warning)" onclick="demoMode()"><i class="fas fa-bolt"></i> Demo Data</button>
        </div>

        <div style="display: flex; gap:10px; align-items:center;">
            <i class="fas fa-bell" style="color:#666; cursor:pointer;"></i>
            <div style="width:30px; height:30px; border-radius:50%; background:linear-gradient(45deg, #3b82f6, #8b5cf6);"></div>
        </div>
    </div>

    <div class="workspace">
        
        <div class="left-panel" id="left-panel">
            <div class="icon-nav">
                <div class="nav-item active" onclick="toggleLeftPanel('layers')"><i class="fas fa-layer-group"></i></div>
                <div class="nav-item" onclick="toggleLeftPanel('ai')"><i class="fas fa-robot"></i></div>
                <div class="nav-item" onclick="toggleLeftPanel('filter')"><i class="fas fa-filter"></i></div>
            </div>

            <div class="panel-content">
                <h3 style="color:#fff; border-bottom:1px solid #333; padding-bottom:10px; margin-top:0;">ONTOLOGY LAYERS</h3>
                <div style="color:#aaa; font-size:12px; line-height:2;">
                    <div><input type="checkbox" checked onclick="toggleLayer('supplier')"> <i class="fas fa-circle" style="color:#ef4444; font-size:8px;"></i> Suppliers</div>
                    <div><input type="checkbox" checked onclick="toggleLayer('factory')"> <i class="fas fa-circle" style="color:#3b82f6; font-size:8px;"></i> Factories</div>
                    <div><input type="checkbox" checked onclick="toggleLayer('material')"> <i class="fas fa-circle" style="color:#f59e0b; font-size:8px;"></i> Materials</div>
                    <div><input type="checkbox" checked onclick="toggleLayer('product')"> <i class="fas fa-circle" style="color:#10b981; font-size:8px;"></i> Products</div>
                </div>

                <div style="margin-top:30px;">
                    <h3 style="color:#fff; border-bottom:1px solid #333; padding-bottom:10px;">AI ASSISTANT</h3>
                    <div style="background:#222; padding:10px; border-radius:4px; color:#ddd; font-size:11px; margin-bottom:10px;">
                        <i class="fas fa-robot" style="color:var(--accent-secondary)"></i> 
                        System detected a bottleneck at <b>Gigafactory 1</b>. Suggest redirecting supply from secondary warehouse.
                    </div>
                    <button class="tool-btn" style="width:100%; justify-content:center;">Ask Co-Pilot</button>
                </div>
            </div>
        </div>

        <div id="cy">
            <div class="graph-stats" id="graph-meta">
                NODES: 0 | EDGES: 0 | DENSITY: 0.00
            </div>
        </div>

        <div class="right-panel" id="right-panel">
            <div class="rp-header">
                <div style="display:flex; justify-content:space-between; align-items:start;">
                    <div>
                        <h2 id="obj-title" style="margin:0; font-size:20px; color:#fff;">Object Name</h2>
                        <span id="obj-type" class="badge bg-blue" style="margin-top:5px; display:inline-block;">TYPE</span>
                    </div>
                    <button onclick="closeRightPanel()" style="background:none; border:none; color:#666; cursor:pointer; font-size:18px;">&times;</button>
                </div>
            </div>
            <div class="rp-body">
                <div style="background:rgba(16,185,129,0.1); border:1px solid rgba(16,185,129,0.3); padding:10px; border-radius:4px; display:flex; gap:10px; align-items:center; margin-bottom:20px;">
                    <i class="fas fa-check-circle" style="color:#10b981; font-size:20px;"></i>
                    <div>
                        <div style="font-size:12px; font-weight:bold; color:#10b981;">OPERATIONAL</div>
                        <div style="font-size:10px; color:#aaa;">Last sync: 2 seconds ago</div>
                    </div>
                </div>

                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="metric-label">Output</div>
                        <div class="metric-val" id="metric-1">98.2%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Risk Score</div>
                        <div class="metric-val" id="metric-2" style="color:#f59e0b">Low</div>
                    </div>
                </div>

                <div style="height:200px; margin-bottom:20px;">
                    <canvas id="detailChart"></canvas>
                </div>

                <h4 style="color:#888; text-transform:uppercase; font-size:11px; margin-bottom:10px; border-bottom:1px solid #333; padding-bottom:5px;">Properties</h4>
                <div id="prop-list" style="font-size:12px; color:#ddd; line-height:1.8;">
                    </div>

                <button class="btn-action"><i class="fas fa-search-location"></i> Trace Roots</button>
                <button class="btn-action" style="background:#333;"><i class="fas fa-file-alt"></i> View Documentation</button>
            </div>
        </div>

    </div>

    <div class="status-bar">
        <div><span class="status-light"></span> SYSTEM ONLINE // CONNECTED TO PROD_DB_01</div>
        <div id="coords">LATency: 12ms | FPS: 60</div>
    </div>

    <script>
        // --- 1. SYSTEM CONFIGURATION ---
        const styles = [
            {
                selector: 'node',
                style: {
                    'label': 'data(label)',
                    'color': '#fff',
                    'font-size': '10px',
                    'font-family': 'Inter',
                    'text-valign': 'bottom',
                    'text-margin-y': 5,
                    'text-background-color': '#000',
                    'text-background-opacity': 0.7,
                    'text-background-padding': '3px',
                    'width': '40px', 'height': '40px',
                    'background-color': '#444',
                    'border-width': 2, 'border-color': '#fff',
                    'transition-property': 'background-color, border-color, width, height',
                    'transition-duration': '0.3s'
                }
            },
            // Specific Types Colors
            { selector: 'node[type="supplier"]', style: { 'background-color': '#ef4444', 'line-color': '#ef4444' } },
            { selector: 'node[type="factory"]', style: { 'background-color': '#3b82f6', 'line-color': '#3b82f6' } },
            { selector: 'node[type="material"]', style: { 'background-color': '#f59e0b', 'line-color': '#f59e0b' } },
            { selector: 'node[type="product"]', style: { 'background-color': '#10b981', 'line-color': '#10b981' } },
            
            {
                selector: 'edge',
                style: {
                    'width': 1.5,
                    'line-color': '#444',
                    'target-arrow-color': '#444',
                    'target-arrow-shape': 'triangle',
                    'curve-style': 'bezier',
                    'arrow-scale': 1
                }
            },
            {
                selector: '.highlighted',
                style: {
                    'background-color': '#fff',
                    'line-color': '#3b82f6',
                    'target-arrow-color': '#3b82f6',
                    'transition-property': 'line-color, target-arrow-color, width',
                    'transition-duration': '0.5s',
                    'width': 3,
                    'z-index': 9999
                }
            },
            {
                selector: '.faded',
                style: { 'opacity': 0.1 }
            },
            {
                selector: ':selected',
                style: {
                    'border-width': 4,
                    'border-color': '#fff',
                    'shadow-blur': 20,
                    'shadow-color': '#fff',
                    'width': '50px', 'height': '50px'
                }
            }
        ];

        // --- 2. INITIALIZE ENGINE ---
        var cy = cytoscape({
            container: document.getElementById('cy'),
            style: styles,
            minZoom: 0.2,
            maxZoom: 3,
            wheelSensitivity: 0.2
        });

        // --- 3. ADVANCED FEATURES ---
        
        // A. Context Menu (Right Click)
        // Note: Needs cytoscape-context-menus extension loaded in head
        // Simple simulation logic for context menu actions
        cy.on('cxttap', 'node', function(evt){
            console.log("Context menu triggered on " + evt.target.id());
            // In a real implementation, the extension UI handles this.
            // Since we rely on CDN, we'll simulate an action:
            alert("System Action: Initiating Deep Scan on " + evt.target.data('label'));
        });

        // B. Path Finding (Simulation)
        let selectedNodes = [];
        cy.on('tap', 'node', function(evt){
            const node = evt.target;
            
            // Logic: Shift+Click to find path between 2 nodes
            if(evt.originalEvent.shiftKey) {
                selectedNodes.push(node);
                node.style('border-color', '#f59e0b'); // Mark as selected
                
                if(selectedNodes.length === 2) {
                    // Run A* or Dijkstra
                    const aStar = cy.elements().aStar({ root: selectedNodes[0], goal: selectedNodes[1] });
                    if(aStar.found) {
                        cy.elements().removeClass('highlighted faded');
                        aStar.path.addClass('highlighted');
                        // Fade others
                        cy.elements().not(aStar.path).addClass('faded');
                        alert("Path Found: Distance " + aStar.distance);
                    } else {
                        alert("No connection found.");
                    }
                    // Reset
                    selectedNodes.forEach(n => n.removeStyle());
                    selectedNodes = [];
                }
            } else {
                // Normal Click -> Open Details
                selectedNodes = []; // Reset pathfinding
                cy.elements().removeClass('faded highlighted');
                const neighborhood = node.neighborhood().add(node);
                cy.elements().not(neighborhood).addClass('faded');
                neighborhood.addClass('highlighted');
                openRightPanel(node.data());
            }
        });

        // Background Tap -> Reset
        cy.on('tap', function(evt){
            if(evt.target === cy){
                cy.elements().removeClass('faded highlighted');
                closeRightPanel();
                if(document.getElementById('left-panel').classList.contains('expanded')) toggleLeftPanel();
            }
        });

        // --- 4. UI FUNCTIONS ---

        function layoutRun(mode) {
            let layoutConfig = {
                name: mode,
                animate: true,
                animationDuration: 800,
                padding: 50
            };
            
            if(mode === 'breadthfirst') {
                layoutConfig.directed = true;
                layoutConfig.spacingFactor = 1.5;
            }
            
            cy.layout(layoutConfig).run();
        }

        function toggleLeftPanel(tab) {
            const panel = document.getElementById('left-panel');
            const items = document.querySelectorAll('.nav-item');
            
            // Toggle Logic
            if(panel.classList.contains('expanded')) {
                // If clicking same tab, close. If diff, switch content (simulated)
                panel.classList.remove('expanded');
            } else {
                panel.classList.add('expanded');
            }
        }

        function openRightPanel(data) {
            const panel = document.getElementById('right-panel');
            panel.classList.add('active');
            
            // Populate Data
            document.getElementById('obj-title').innerText = data.label;
            document.getElementById('obj-type').innerText = (data.type || 'Object').toUpperCase();
            document.getElementById('obj-type').className = `badge ${data.type === 'supplier' ? 'bg-red' : 'bg-blue'}`;
            
            // Parse Details
            let html = '';
            if(data.details) {
                data.details.split('|').forEach(p => {
                    let [k,v] = p.split(':');
                    if(k&&v) html += `<div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span style="color:#888">${k}</span><span>${v}</span></div>`;
                });
            } else {
                html = '<div style="color:#666; text-align:center;">No metadata available</div>';
            }
            document.getElementById('prop-list').innerHTML = html;

            // Render Chart
            renderMiniChart();
        }

        function closeRightPanel() {
            document.getElementById('right-panel').classList.remove('active');
        }

        function toggleLayer(type) {
            const nodes = cy.nodes(`[type = "${type}"]`);
            if(nodes.visible()) nodes.hide();
            else nodes.show();
        }

        function searchGraph() {
            const query = document.getElementById('global-search').value.toLowerCase();
            if(!query) {
                cy.elements().removeClass('faded highlighted');
                return;
            }
            
            const target = cy.nodes().filter(n => n.data('label').toLowerCase().includes(query));
            if(target.length > 0) {
                cy.elements().addClass('faded');
                target.removeClass('faded').addClass('highlighted');
                cy.animate({
                    fit: { eles: target, padding: 50 },
                    duration: 500
                });
            }
        }

        // --- 5. CHART ENGINE ---
        let chartInstance = null;
        function renderMiniChart() {
            const ctx = document.getElementById('detailChart').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['10:00', '11:00', '12:00', '13:00', '14:00'],
                    datasets: [{
                        label: 'Throughput',
                        data: Array.from({length:5}, () => Math.floor(Math.random()*100)),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { display: true, grid: { color: '#333' } }
                    }
                }
            });
        }

        // --- 6. DEMO DATA GENERATOR ---
        function demoMode() {
            // Generate Complex Supply Chain
            cy.elements().remove();
            
            const nodes = [
                { id: 's1', label: 'Apex Mining', type: 'supplier', details: 'Loc: Chile|Risk: High' },
                { id: 's2', label: 'Nordic Chip', type: 'supplier', details: 'Loc: Norway|Risk: Low' },
                { id: 'm1', label: 'Raw Lithium', type: 'material', details: 'Stock: 400T' },
                { id: 'm2', label: 'Semiconductors', type: 'material', details: 'Stock: 50k Units' },
                { id: 'f1', label: 'Gigafactory NV', type: 'factory', details: 'Cap: 98%|Status: Warning' },
                { id: 'f2', label: 'Assembly DE', type: 'factory', details: 'Cap: 85%|Status: OK' },
                { id: 'p1', label: 'Model S Plaid', type: 'product', details: 'Backlog: 200' },
                { id: 'p2', label: 'Cybertruck', type: 'product', details: 'Backlog: 5000' }
            ];

            const edges = [
                { source: 's1', target: 'm1' },
                { source: 's2', target: 'm2' },
                { source: 'm1', target: 'f1' },
                { source: 'm2', target: 'f1' },
                { source: 'm2', target: 'f2' },
                { source: 'f1', target: 'p1' },
                { source: 'f1', target: 'p2' },
                { source: 'f2', target: 'p1' }
            ];

            nodes.forEach(n => cy.add({ group:'nodes', data:n }));
            edges.forEach(e => cy.add({ group:'edges', data:e }));

            layoutRun('breadthfirst');
            updateMeta();
        }

        function updateMeta() {
            document.getElementById('graph-meta').innerText = `NODES: ${cy.nodes().length} | EDGES: ${cy.edges().length} | SYSTEM: SECURE`;
        }

        // --- 7. EXCEL LOADER ---
        document.getElementById('file-upload').addEventListener('change', function(e) {
            var file = e.target.files[0];
            if (!file) return;
            var reader = new FileReader();
            reader.onload = function(e) {
                var data = new Uint8Array(e.target.result);
                var workbook = XLSX.read(data, {type: 'array'});
                var nodes = XLSX.utils.sheet_to_json(workbook.Sheets['Nodes']);
                var edges = XLSX.utils.sheet_to_json(workbook.Sheets['Edges']);
                cy.elements().remove();
                nodes.forEach(n => cy.add({ group: 'nodes', data: { id: n.id.toString(), label: n.label, type: (n.type||'').toLowerCase(), details: n.details } }));
                edges.forEach(e => cy.add({ group: 'edges', data: { source: e.source.toString(), target: e.target.toString(), label: e.label } }));
                layoutRun('breadthfirst');
                updateMeta();
            };
            reader.readAsArrayBuffer(file);
        });

        // Init
        demoMode();

    </script>
</body>
</html>
