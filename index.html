<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ontology System Interface</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.26.0/cytoscape.min.js"></script>
    <style>
        /* --- CSS STYLING --- */
        body {
            background-color: #0a0a0a; /* Dark Background */
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            overflow: hidden;
            display: flex;
            height: 100vh;
        }

        /* พื้นหลัง Grid แบบ Tech */
        #cy {
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(30, 30, 30, 0.5) 1px, transparent 1px),
                linear-gradient(90deg, rgba(30, 30, 30, 0.5) 1px, transparent 1px);
            background-size: 40px 40px;
            z-index: 1;
        }

        /* กล่องแสดงข้อมูล (Object Details Panel) */
        #info-panel {
            position: absolute;
            top: 100px;
            left: 20px;
            width: 280px;
            background: rgba(15, 15, 20, 0.95);
            border: 1px solid #333;
            border-left: 3px solid #3b82f6; /* สีฟ้า Palantir */
            padding: 15px;
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
            display: none; /* ซ่อนไว้ก่อน */
            z-index: 10;
            backdrop-filter: blur(5px);
        }

        #info-panel h3 {
            margin-top: 0;
            color: #fff;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid #333;
            padding-bottom: 8px;
            margin-bottom: 10px;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 6px;
        }

        .label { color: #888; }
        .value { color: #fff; font-weight: bold; }
        
        .status-dot {
            height: 8px;
            width: 8px;
            background-color: #22c55e;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }

        /* Header ตกแต่ง */
        .header-ui {
            position: absolute;
            top: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5;
            pointer-events: none;
        }
        
        .title-badge {
            border: 1px solid #333;
            padding: 5px 20px;
            border-radius: 20px;
            background: rgba(0,0,0,0.6);
            font-size: 12px;
            color: #888;
            letter-spacing: 2px;
        }
    </style>
</head>
<body>

    <div class="header-ui">
        <div class="title-badge">◇ ONTOLOGY VIEW</div>
    </div>

    <div id="cy"></div>

    <div id="info-panel">
        <h3 id="panel-title">OBJECT DETAILS</h3>
        <div id="panel-content">
            </div>
    </div>

    <script>
        // --- JAVASCRIPT CONFIG --- //
        
        // 1. กำหนดข้อมูล Nodes (วัตถุ) และ Edges (เส้นเชื่อม)
        const elements = [
            // Nodes กลุ่มหลัก
            { data: { id: 'supplier', label: 'Supplier', type: 'core' } },
            { data: { id: 'po', label: 'Purchase Order', type: 'doc' } },
            { data: { id: 'inventory', label: 'Inventory', type: 'object' } },
            { data: { id: 'material', label: 'Material', type: 'object' } },
            { data: { id: 'factory', label: 'Factory', type: 'place' } },
            
            // Edges เส้นเชื่อมโยง
            { data: { source: 'supplier', target: 'po', label: 'issues' } },
            { data: { source: 'po', target: 'inventory', label: 'stocks' } },
            { data: { source: 'inventory', target: 'material', label: 'contains' } },
            { data: { source: 'material', target: 'factory', label: 'used_in' } },
            { data: { source: 'supplier', target: 'factory', label: 'ships_to' } }
        ];

        // 2. Initialize Cytoscape
        var cy = cytoscape({
            container: document.getElementById('cy'), // ระบุ div ที่จะแสดงกราฟ

            elements: elements,

            style: [ // กำหนดสไตล์ของกราฟ (เหมือน CSS แต่นิยามใน JS)
                {
                    selector: 'node',
                    style: {
                        'background-color': '#1f2937',
                        'label': 'data(label)',
                        'color': '#fff',
                        'font-size': '12px',
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'width': '120px',
                        'height': '40px',
                        'shape': 'round-rectangle',
                        'border-width': 2,
                        'border-color': '#3b82f6', // สีฟ้าขอบ
                        'border-opacity': 0.8,
                        'text-transform': 'uppercase'
                    }
                },
                {
                    selector: 'node[type="doc"]', // เปลี่ยนสีตามประเภท
                    style: {
                        'border-color': '#8b5cf6', // สีม่วง
                        'background-color': '#2e1065'
                    }
                },
                {
                    selector: 'node[type="place"]',
                    style: {
                        'border-color': '#10b981', // สีเขียว
                        'background-color': '#064e3b'
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 2,
                        'line-color': '#4b5563',
                        'target-arrow-color': '#4b5563',
                        'target-arrow-shape': 'triangle',
                        'curve-style': 'bezier',
                        'font-size': '10px',
                        'color': '#6b7280',
                        'label': 'data(label)',
                        'text-background-opacity': 1,
                        'text-background-color': '#0a0a0a',
                        'text-background-padding': '3px'
                    }
                },
                {
                    selector: ':selected', // สไตล์ตอนถูกเลือก
                    style: {
                        'border-width': 4,
                        'border-color': '#fff',
                        'shadow-blur': 10,
                        'shadow-color': '#fff'
                    }
                }
            ],

            layout: {
                name: 'breadthfirst', // การจัดวางแบบลำดับชั้น
                directed: true,
                padding: 50,
                spacingFactor: 1.5
            }
        });

        // 3. ฟังก์ชัน Click Event (กดที่ Object)
        cy.on('tap', 'node', function(evt){
            var node = evt.target;
            var data = node.data();

            // Mockup ข้อมูลที่จะโชว์ใน Panel ตาม ID ของ Node
            let detailsHtml = '';
            
            if(data.id === 'supplier') {
                detailsHtml = `
                    <div class="data-row"><span class="label">Name</span><span class="value">Apex Industries</span></div>
                    <div class="data-row"><span class="label">Status</span><span class="value"><span class="status-dot"></span>Active</span></div>
                    <div class="data-row"><span class="label">Lead Time</span><span class="value">13 Days</span></div>
                    <div class="data-row"><span class="label">Total Spend</span><span class="value">$51,000</span></div>
                    <div class="data-row"><span class="label">Score</span><span class="value">93/100</span></div>
                `;
            } else if (data.id === 'inventory') {
                detailsHtml = `
                    <div class="data-row"><span class="label">SKU</span><span class="value">MX-9920</span></div>
                    <div class="data-row"><span class="label">Location</span><span class="value">Warehouse A</span></div>
                    <div class="data-row"><span class="label">Quantity</span><span class="value">4,500 Units</span></div>
                `;
            } else {
                detailsHtml = `
                    <div class="data-row"><span class="label">ID</span><span class="value">#${data.id.toUpperCase()}</span></div>
                    <div class="data-row"><span class="label">Type</span><span class="value">${data.type}</span></div>
                    <div class="data-row"><span class="label">Last Updated</span><span class="value">2 mins ago</span></div>
                `;
            }

            // อัปเดตและแสดง Panel
            document.getElementById('panel-title').innerText = data.label + " OBJECT";
            document.getElementById('panel-content').innerHTML = detailsHtml;
            document.getElementById('info-panel').style.display = 'block';
        });

        // คลิกที่พื้นหลังเพื่อปิด Panel
        cy.on('tap', function(event){
            if( event.target === cy ){
                document.getElementById('info-panel').style.display = 'none';
            }
        });

    </script>
</body>
</html>
